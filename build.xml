<?xml version="1.0"?>
<project name="project" default="com" basedir=".">

    <taskdef name="command" 
             classname="lib.S2Base.src.phing.task.S2Base_CommandTask" />
    <taskdef name="gdao" 
             classname="lib.S2Dao.src.phing.task.S2DaoSkeletonTask" />

    <target name="prepare">
        <property name="project.name" value="${phing.project.name}" />
        <property name="cmd.dir" value="${project.basedir}/app/commands" />
        <property name="plugins.dir" value="${project.basedir}/vendor/plugins" />
        <property name="td" value="" />

        <!-- default and with smarty or agavi-->
        <php expression="require_once('config/environment.inc.php')"/>

        <!-- with maple 
        <php expression="require_once('/work/web/maple/webapp/config/maple.inc.php')"/>
        -->

        <php expression="require_once('lib/S2Base/S2Base.cmd.php')"/>
    </target>

    <target name="com" depends="prepare">
        <command>
            <!-- with smarty
            <fileset dir="${cmd.dir}/smarty">
                <include name="*Command.class.php"/>
            </fileset>
            -->

            <!-- with maple
            <fileset dir="${cmd.dir}/maple">
                <include name="*Command.class.php"/>
            </fileset>
            -->
            
            <!-- default -->
            <fileset dir="${cmd.dir}">
                <include name="*Command.class.php"/>
            </fileset>
        </command>
    </target>
    
    <target name="gen-dao" depends="prepare">
        <property name="dsn" value="mysql:host=localhost; dbname=s2container" />
        <property name="user" value="root" />
        <property name="password" value="" />
        <gdao toDir="app/commons/dao" />
    </target>

    <target name="test" depends="prepare">
        <echo>test directory : test/${td}</echo>
        <phpunit2 haltonfailure="false" haltonerror="false">
            <formatter type="plain" usefile="false"/>
            <batchtest>
                <fileset dir="test/${td}">
                    <include name="**/*Test.class.php"/>
                </fileset>
            </batchtest>
        </phpunit2>
    </target>
	
	<!-- [ Plugins Section ] -->
	<!-- Agavi -->
    <target name="agavi" depends="prepare">
		<available file="${plugins.dir}/agavi" type="dir" property="plugin.available" />
		<fail unless="plugin.available" message="Invalid : [ Agavi plugin ]" />
        <phing phingfile="${plugins.dir}/agavi/build-agavi.xml" inheritRefs="true" target="${td}"/>
    </target>

	<!-- Ethna -->
    <target name="ethna" depends="prepare">
		<available file="${plugins.dir}/ethna" type="dir" property="plugin.available" />
		<fail unless="plugin.available" message="Invalid : [ Ethna plugin ]" />
        <phing phingfile="${plugins.dir}/ethna/build-ethna.xml" inheritRefs="true" target="${td}"/>
    </target>
    
	<!-- Symfony -->
    <target name="symfony" depends="prepare">
		<available file="${plugins.dir}/symfony" type="dir" property="plugin.available" />
		<fail unless="plugin.available" message="Invalid : [ Symfony plugin ]" />
        <phing phingfile="${plugins.dir}/symfony/build-symfony.xml" inheritRefs="true" target="${td}"/>
    </target>
 	
	<!-- ZendFramework -->
    <target name="zend" depends="prepare">
		<available file="${plugins.dir}/zend" type="dir" property="plugin.available" />
		<fail unless="plugin.available" message="Invalid : [ ZendFramework plugin ]" />
        <phing phingfile="${plugins.dir}/zendframework/build-zend.xml" inheritRefs="true" target="${td}"/>
    </target>
 	
</project>
